<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width="initial-scale=1" />
  <title>Invitation Builder v2 - Modular with Sidebars</title>
  
  <!-- External CSS and JS modules -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link id="gfonts" href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  
  <!-- External CSS files -->
  <link rel="stylesheet" href="css/01-variables.css">
  <link rel="stylesheet" href="css/02-layout.css">
  <link rel="stylesheet" href="css/03-typography.css">
  <link rel="stylesheet" href="css/04-forms.css">
  <link rel="stylesheet" href="css/05-canvas.css">
  <link rel="stylesheet" href="css/06-animations.css">
  <link rel="stylesheet" href="css/07-notifications.css">
  <link rel="stylesheet" href="css/08-controls.css">
  <link rel="stylesheet" href="css/09-interactive.css">
  <link rel="stylesheet" href="css/10-responsive.css">
  
  <style>
    /* Additional custom styles for v2 */
    .test-button {
      background: #FF9800;
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 8px 0;
      width: 100%;
    }
    
    .test-button:hover {
      background: #F57C00;
    }
    
    .status-display {
      background: #f0f0f0;
      padding: 12px;
      border-radius: 8px;
      font-size: 12px;
      color: #666;
      margin-top: 16px;
    }
    
    /* Ensure stage content is properly styled */
    .stage-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      padding: 40px;
    }
    
    .stage h1, .stage h2, .stage p {
      margin: 0;
      min-height: 24px;
      display: flex;
      align-items: center;
    }
    
    .stage h1 {
      font-size: 48px;
      margin-bottom: 20px;
      min-height: 60px;
    }
    
    .stage h2 {
      font-size: 32px;
      margin-bottom: 30px;
      min-height: 40px;
    }
    
    .stage p {
      font-size: 18px;
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Left Sidebar: Text Editing Controls -->
    <div id="left-panel-container"></div>
    
    <!-- Center Stage Area -->
    <main class="stage-wrap">
      <section class="stage" id="stage">
        <div class="stage-content">
          <!-- Title Display -->
          <h1 id="title-display">Invitation Builder v2</h1>
          
          <!-- Subtitle Display -->
          <p id="subtitle-display">Modular version with dual sidebars</p>
          
          <!-- Names Display -->
          <h2 id="names-display">Your Names Here</h2>
          
          <!-- Status Display -->
          <div class="status-display">
            <strong>Current Status:</strong><br>
            âœ… Basic HTML structure<br>
            âœ… CSS variables and layout<br>
            âœ… Dual sidebar system<br>
            âœ… Text input system<br>
            âœ… Color system<br>
            âœ… Font system<br>
            âœ… Background system<br>
            âœ… Validation system<br>
            ðŸ”„ Next: Adding sprite system
          </div>
        </div>
      </section>
    </main>
    
    <!-- Right Sidebar: All Other Controls -->
    <div id="right-panel-container"></div>
  </div>
  
  <!-- External JavaScript modules -->
  <script type="module" src="js/partial-loader.js"></script>
  <script type="module" src="js/main.js"></script>
  <script type="module" src="js/select-initializer.js"></script>
  <script type="module" src="js/sprite-browser.js"></script>
  <script type="module" src="js/sprite-manager.js"></script>
  <script type="module" src="js/event-handlers.js"></script>
  
  <!-- Main application script -->
  <script type="module">
    import { loadPartials } from './js/partial-loader.js';
    import { updateFonts, updateText } from './js/main.js';
    
    // Initialize the application
    async function initializeApp() {
      console.log('ðŸš€ Initializing Invitation Builder v2...');
      
      try {
        // Load sidebar partials
        await loadPartials();
        
        // Set up event listeners for the new sidebar structure
        setupSidebarEventListeners();
        
        // Initialize all systems
        initializeAllSystems();
        
        console.log('âœ… Invitation Builder v2 initialized successfully');
        
      } catch (error) {
        console.error('âŒ Failed to initialize app:', error);
      }
    }
    
    // Set up event listeners for the new sidebar structure
    function setupSidebarEventListeners() {
      console.log('ðŸ”§ Setting up sidebar event listeners...');
      
      // Wait for partials to be loaded
      setTimeout(() => {
        // Text input listeners
        const textInputs = ['pill', 'title', 'subtitle', 'names', 'date', 'time', 'location', 'rsvp'];
        textInputs.forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('input', handleTextChange);
            console.log(`ðŸ“ Added text listener for ${id}`);
          }
        });
        
        // Color input listeners
        const colorInputs = ['accent', 'accent2'];
        colorInputs.forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('input', handleColorChange);
            console.log(`ðŸŽ¨ Added color listener for ${id}`);
          }
        });
        
        // Font select listeners
        const fontSelects = ['font-title', 'font-names', 'font-body'];
        fontSelects.forEach(id => {
          const select = document.getElementById(id);
          if (select) {
            select.addEventListener('change', handleFontChange);
            console.log(`ðŸ”¤ Added font listener for ${id}`);
          }
        });
        
        // Background system listeners
        const bgInputs = ['bg-mode', 'texture', 'tex-opacity', 'tex-scale', 'stock-image', 'img-opacity', 'img-blur', 'img-bright', 'img-vignette'];
        bgInputs.forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('change', handleBackgroundChange);
            input.addEventListener('input', handleBackgroundChange);
            console.log(`ðŸ–¼ï¸ Added background listener for ${id}`);
          }
        });
        
        // Edge system listeners
        const edgeInputs = ['edge-style', 'edge-variant', 'edge-thickness', 'edge-opacity', 'edge-color'];
        edgeInputs.forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('change', handleEdgeChange);
            input.addEventListener('input', handleEdgeChange);
            console.log(`âœ‚ï¸ Added edge listener for ${id}`);
          }
        });
        
        // Overlay system listeners
        const overlayInputs = ['overlay-style', 'overlay-opacity', 'overlay-scale', 'overlay-position', 'overlay-blend'];
        overlayInputs.forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('change', handleOverlayChange);
            input.addEventListener('input', handleOverlayChange);
            console.log(`ðŸŽ¨ Added overlay listener for ${id}`);
          }
        });
        
        // Shadow system listeners
        const shadowInputs = ['shadow-x', 'shadow-y', 'shadow-blur', 'shadow-color', 'shadow-opacity'];
        shadowInputs.forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('change', handleShadowChange);
            input.addEventListener('input', handleShadowChange);
            console.log(`ðŸŒ‘ Added shadow listener for ${id}`);
          }
        });
        
        // Layout and effects listeners
        const effectInputs = ['layout', 'effect', 'parallax', 'density', 'scale', 'sprite-anim'];
        effectInputs.forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('change', handleEffectChange);
            input.addEventListener('input', handleEffectChange);
            console.log(`ðŸŽ­ Added effect listener for ${id}`);
          }
        });
        
        console.log('âœ… All sidebar event listeners set up');
        
      }, 500); // Wait for partials to load
    }
    
    // Event handler functions
    function handleTextChange(event) {
      const input = event.target;
      const value = input.value;
      const id = input.id;
      
      console.log(`ðŸ“ Text changed: ${id} = "${value}"`);
      
      // Update corresponding display elements
      switch (id) {
        case 'title':
          updateDisplayElement('title-display', value);
          break;
        case 'subtitle':
          updateDisplayElement('subtitle-display', value);
          break;
        case 'names':
          updateDisplayElement('names-display', value);
          break;
        // Add other text fields as needed
      }
    }
    
    function handleColorChange(event) {
      const input = event.target;
      const value = input.value;
      const id = input.id;
      
      console.log(`ðŸŽ¨ Color changed: ${id} = ${value}`);
      
      // Update CSS variables
      if (id === 'accent') {
        document.documentElement.style.setProperty('--accent', value);
        updateDisplayElement('title-display', null, { color: value });
      } else if (id === 'accent2') {
        document.documentElement.style.setProperty('--accent-2', value);
        updateDisplayElement('names-display', null, { color: value });
      }
    }
    
    function handleFontChange(event) {
      const select = event.target;
      const value = select.value;
      const id = select.id;
      
      console.log(`ðŸ”¤ Font changed: ${id} = ${value}`);
      
      // Update fonts using the existing font system
      updateFonts();
    }
    
    function handleBackgroundChange(event) {
      const input = event.target;
      const value = input.value;
      const id = input.id;
      
      console.log(`ðŸ–¼ï¸ Background changed: ${id} = ${value}`);
      
      // Update background using the existing background system
      updateBackground();
    }
    
    function handleEdgeChange(event) {
      const input = event.target;
      const value = input.value;
      const id = input.id;
      
      console.log(`âœ‚ï¸ Edge changed: ${id} = ${value}`);
      
      // Update edge effects
      updateEdgeEffects();
    }
    
    function handleOverlayChange(event) {
      const input = event.target;
      const value = input.value;
      const id = input.id;
      
      console.log(`ðŸŽ¨ Overlay changed: ${id} = ${value}`);
      
      // Update overlay effects
      updateOverlayEffects();
    }
    
    function handleShadowChange(event) {
      const input = event.target;
      const value = input.value;
      const id = input.id;
      
      console.log(`ðŸŒ‘ Shadow changed: ${id} = ${value}`);
      
      // Update shadow effects
      updateShadowEffects();
    }
    
    function handleEffectChange(event) {
      const input = event.target;
      const value = input.value;
      const id = input.id;
      
      console.log(`ðŸŽ­ Effect changed: ${id} = ${value}`);
      
      // Update effects
      updateEffects();
    }
    
    // Helper functions
    function updateDisplayElement(elementId, text, styles = {}) {
      const element = document.getElementById(elementId);
      if (element) {
        if (text !== null) {
          element.textContent = text;
        }
        if (styles) {
          Object.assign(element.style, styles);
        }
      }
    }
    
    // Placeholder functions for systems that will be implemented
    function updateBackground() {
      console.log('ðŸ–¼ï¸ Background system update (to be implemented)');
    }
    
    function updateEdgeEffects() {
      console.log('âœ‚ï¸ Edge effects update (to be implemented)');
    }
    
    function updateOverlayEffects() {
      console.log('ðŸŽ¨ Overlay effects update (to be implemented)');
    }
    
    function updateShadowEffects() {
      console.log('ðŸŒ‘ Shadow effects update (to be implemented)');
    }
    
    function updateEffects() {
      console.log('ðŸŽ­ Effects update (to be implemented)');
    }
    
    // Initialize all systems
    function initializeAllSystems() {
      console.log('ðŸš€ Initializing all systems...');
      
      // Set initial values for display elements
      const initialTexts = {
        'title-display': 'Invitation Builder v2',
        'subtitle-display': 'Modular version with dual sidebars',
        'names-display': 'Your Names Here'
      };
      
      Object.entries(initialTexts).forEach(([id, text]) => {
        updateDisplayElement(id, text);
      });
      
      console.log('âœ… All systems initialized');
    }
    
    // Start the application when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
</body>
</html>
