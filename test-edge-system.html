<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edge System Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f0f0f0;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .edge-preview {
      width: 300px;
      height: 400px;
      border: 2px solid #ccc;
      margin: 20px auto;
      position: relative;
      background: #f9f9f9;
    }
    .edge-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    .control-group {
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
    }
    label {
      display: block;
      margin: 10px 0 5px 0;
      font-weight: bold;
    }
    select, input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .status {
      background: #e8f5e8;
      border: 1px solid #4caf50;
      padding: 10px;
      border-radius: 5px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>‚úÇÔ∏è Edge System Test</h1>
    <p>This test verifies that edge effects are applied live without needing an "Apply Edge" button.</p>
    
    <div class="status">
      <strong>‚úÖ Status:</strong> Edge controls should update the preview in real-time as you change settings.
    </div>
    
    <div class="edge-preview">
      <div class="edge-layer" id="edge-layer"></div>
      <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666;">
        <h3>Edge Preview</h3>
        <p>Changes should appear instantly</p>
      </div>
    </div>
    
    <div class="controls">
      <div class="control-group">
        <label>Edge Style</label>
        <select id="edge-style">
          <option value="none">None</option>
          <option value="torn">Torn Paper</option>
          <option value="scalloped">Scalloped</option>
          <option value="wave">Wavy</option>
          <option value="zigzag">Zigzag</option>
          <option value="spikes">Spikes</option>
          <option value="dots">Dots</option>
          <option value="geometric">Geometric</option>
          <option value="organic">Organic</option>
          <option value="vintage">Vintage</option>
        </select>
        
        <label>Edge Variant</label>
        <select id="edge-variant">
          <option value="default">Default</option>
          <option value="rough">Rough</option>
          <option value="smooth">Smooth</option>
          <option value="sharp">Sharp</option>
          <option value="soft">Soft</option>
        </select>
      </div>
      
      <div class="control-group">
        <div class="row">
          <div>
            <label>Thickness: <span id="edge-thickness-value">2</span>px</label>
            <input type="range" id="edge-thickness" min="1" max="10" value="2" step="1">
          </div>
          <div>
            <label>Opacity: <span id="edge-opacity-value">0.8</span></label>
            <input type="range" id="edge-opacity" min="0" max="1" value="0.8" step="0.1">
          </div>
        </div>
        
        <label>Edge Color</label>
        <input type="color" id="edge-color" value="#ffffff">
      </div>
    </div>
    
    <div class="status">
      <strong>üéØ Test Instructions:</strong>
      <ol>
        <li>Change the Edge Style - you should see the effect immediately</li>
        <li>Change the Edge Variant - the texture should update instantly</li>
        <li>Adjust Thickness - the edge should get thicker/thinner in real-time</li>
        <li>Change Opacity - the edge should fade in/out immediately</li>
        <li>Pick a different color - the edge should change color instantly</li>
      </ol>
      <p><strong>Expected Result:</strong> All changes should be reflected immediately without needing to click any "Apply" button.</p>
    </div>
  </div>

  <script>
    // Edge styles configuration (copied from config.js)
    const EDGE_STYLES = {
      none: null,
      torn: {
        default: 'M0,0 Q25,5 50,0 T100,0 L100,100 Q75,95 50,100 T0,100 Z',
        rough: 'M0,0 Q20,8 40,2 Q60,-3 80,1 Q90,4 100,0 L100,100 Q80,92 60,98 Q40,103 20,97 Q10,95 0,100 Z',
        smooth: 'M0,0 Q30,3 60,0 Q80,2 100,0 L100,100 Q70,97 40,100 Q20,98 0,100 Z',
        sharp: 'M0,0 L15,5 L30,0 L45,8 L60,2 L75,0 L90,6 L100,0 L100,100 L85,95 L70,100 L55,92 L40,98 L25,100 L10,94 L0,100 Z',
        soft: 'M0,0 Q20,2 40,0 Q60,1 80,0 Q90,1 100,0 L100,100 Q80,98 60,100 Q40,99 20,100 Q10,99 0,100 Z'
      },
      scalloped: {
        default: 'M0,0 Q25,15 50,0 Q75,15 100,0 L100,100 Q75,85 50,100 Q25,85 0,100 Z',
        rough: 'M0,0 Q20,18 40,2 Q60,20 80,0 Q90,12 100,0 L100,100 Q80,82 60,100 Q40,80 20,98 Q10,85 0,100 Z',
        smooth: 'M0,0 Q30,12 60,0 Q80,15 100,0 L100,100 Q70,88 40,100 Q20,85 0,100 Z',
        sharp: 'M0,0 L25,20 L50,0 L75,20 L100,0 L100,100 L75,80 L50,100 L25,80 L0,100 Z',
        soft: 'M0,0 Q25,10 50,0 Q75,10 100,0 L100,100 Q75,90 50,100 Q25,90 0,100 Z'
      },
      zigzag: {
        default: 'M0,0 L25,15 L50,0 L75,15 L100,0 L100,100 L75,85 L50,100 L25,85 L0,100 Z',
        rough: 'M0,0 L20,18 L40,2 L60,20 L80,0 L100,18 L100,100 L80,82 L60,100 L40,80 L20,100 L0,82 Z',
        smooth: 'M0,0 Q25,15 50,0 Q75,15 100,0 L100,100 Q75,85 50,100 Q25,85 0,100 Z',
        sharp: 'M0,0 L25,20 L50,0 L75,20 L100,0 L100,100 L75,80 L50,100 L25,80 L0,100 Z',
        soft: 'M0,0 Q25,12 50,0 Q75,12 100,0 L100,100 Q75,88 50,100 Q25,88 0,100 Z'
      },
      wave: {
        default: 'M0,0 Q25,10 50,0 Q75,10 100,0 L100,100 Q75,90 50,100 Q25,90 0,100 Z',
        rough: 'M0,0 Q20,12 40,0 Q60,15 80,0 Q90,8 100,0 L100,100 Q80,88 60,100 Q40,85 20,100 Q10,92 0,100 Z',
        smooth: 'M0,0 Q30,8 60,0 Q80,12 100,0 L100,100 Q70,92 40,100 Q20,88 0,100 Z',
        sharp: 'M0,0 L25,15 L50,0 L75,15 L100,0 L100,100 L75,85 L50,100 L25,85 L0,100 Z',
        soft: 'M0,0 Q25,6 50,0 Q75,6 100,0 L100,100 Q75,94 50,100 Q25,94 0,100 Z'
      },
      spikes: {
        default: 'M0,0 L25,20 L50,0 L75,20 L100,0 L100,100 L75,80 L50,100 L25,80 L0,100 Z',
        rough: 'M0,0 L20,22 L40,0 L60,25 L80,0 L100,18 L100,100 L80,78 L60,100 L40,75 L20,100 L0,78 Z',
        smooth: 'M0,0 Q25,18 50,0 Q75,18 100,0 L100,100 Q75,82 50,100 Q25,82 0,100 Z',
        sharp: 'M0,0 L25,25 L50,0 L75,25 L100,0 L100,100 L75,75 L50,100 L25,75 L0,100 Z',
        soft: 'M0,0 Q25,15 50,0 Q75,15 100,0 L100,100 Q75,85 50,100 Q25,85 0,100 Z'
      },
      dots: {
        default: 'M0,0 Q25,5 50,0 Q75,5 100,0 L100,100 Q75,95 50,100 Q25,95 0,100 Z',
        rough: 'M0,0 Q20,8 40,0 Q60,10 80,0 Q90,3 100,0 L100,100 Q80,92 60,100 Q40,90 20,100 Q10,97 0,100 Z',
        smooth: 'M0,0 Q30,3 60,0 Q80,8 100,0 L100,100 Q70,97 40,100 Q20,92 0,100 Z',
        sharp: 'M0,0 L25,10 L50,0 L75,10 L100,0 L100,100 L75,90 L50,100 L25,90 L0,100 Z',
        soft: 'M0,0 Q25,4 50,0 Q75,4 100,0 L100,100 Q75,96 50,100 Q25,96 0,100 Z'
      },
      geometric: {
        default: 'M0,0 L25,15 L50,0 L75,15 L100,0 L100,100 L75,85 L50,100 L25,85 L0,100 Z',
        rough: 'M0,0 L20,18 L40,0 L60,20 L80,0 L100,18 L100,100 L80,82 L60,100 L40,80 L20,100 L0,82 Z',
        smooth: 'M0,0 Q25,12 50,0 Q75,12 100,0 L100,100 Q75,88 50,100 Q25,88 0,100 Z',
        sharp: 'M0,0 L25,20 L50,0 L75,20 L100,0 L100,100 L75,80 L50,100 L25,80 L0,100 Z',
        soft: 'M0,0 Q25,10 50,0 Q75,10 100,100 Q75,90 50,100 Q25,90 0,100 Z'
      },
      organic: {
        default: 'M0,0 Q25,8 50,0 Q75,8 100,0 L100,100 Q75,92 50,100 Q25,92 0,100 Z',
        rough: 'M0,0 Q20,12 40,0 Q60,15 80,0 Q90,6 100,0 L100,100 Q80,88 60,100 Q40,85 20,100 Q10,94 0,100 Z',
        smooth: 'M0,0 Q30,6 60,0 Q80,10 100,0 L100,100 Q70,94 40,100 Q20,90 0,100 Z',
        sharp: 'M0,0 L25,18 L50,0 L75,18 L100,0 L100,100 L75,82 L50,100 L25,82 L0,100 Z',
        soft: 'M0,0 Q25,8 50,0 Q75,8 100,0 L100,100 Q75,92 50,100 Q25,92 0,100 Z'
      },
      vintage: {
        default: 'M0,0 Q25,10 50,0 Q75,10 100,0 L100,100 Q75,90 50,100 Q25,90 0,100 Z',
        rough: 'M0,0 Q20,15 40,0 Q60,18 80,0 Q90,8 100,0 L100,100 Q80,85 60,100 Q40,82 20,100 Q10,92 0,100 Z',
        smooth: 'M0,0 Q30,8 60,0 Q80,12 100,0 L100,100 Q70,92 40,100 Q20,88 0,100 Z',
        sharp: 'M0,0 L25,20 L50,0 L75,20 L100,0 L100,100 L75,80 L50,100 L25,80 L0,100 Z',
        soft: 'M0,0 Q25,12 50,0 Q75,12 100,0 L100,100 Q75,88 50,100 Q25,88 0,100 Z'
      }
    };
    
    // Edge settings
    let edgeSettings = {
      style: 'none',
      variant: 'default',
      thickness: 2,
      opacity: 0.8,
      color: '#ffffff'
    };
    
    // Apply edge effect to the preview
    function applyEdgeEffect() {
      const edgeLayer = document.getElementById('edge-layer');
      edgeLayer.innerHTML = '';
      
      if (edgeSettings.style === 'none') {
        return;
      }
      
      const style = EDGE_STYLES[edgeSettings.style];
      if (!style) return;
      
      const variant = style[edgeSettings.variant] || style.default;
      if (!variant) return;
      
      // Create SVG for the edge effect
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', '0 0 300 400');
      svg.setAttribute('preserveAspectRatio', 'none');
      svg.style.position = 'absolute';
      svg.style.top = '0';
      svg.style.left = '0';
      svg.style.width = '100%';
      svg.style.height = '100%';
      svg.style.pointerEvents = 'none';
      
      // Create edge effects for all four sides
      createEdgePath(svg, variant, 'top', 0, 0, 300, 0);
      createEdgePath(svg, variant, 'bottom', 0, 400, 300, 400);
      createEdgePath(svg, variant, 'left', 0, 0, 0, 400);
      createEdgePath(svg, variant, 'right', 300, 0, 300, 400);
      
      edgeLayer.appendChild(svg);
      
      console.log('‚ú® Edge effect applied:', edgeSettings.style, edgeSettings.variant);
    }
    
    // Helper function to create edge paths for each side
    function createEdgePath(svg, variant, side, x1, y1, x2, y2) {
      const edgePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      
      let pathData = '';
      
      if (side === 'top' || side === 'bottom') {
        // Horizontal edges (top/bottom)
        pathData = createHorizontalEdgePath(variant, x1, y1, x2, y2);
      } else {
        // Vertical edges (left/right)
        pathData = createVerticalEdgePath(variant, x1, y1, x2, y2);
      }
      
      edgePath.setAttribute('d', pathData);
      edgePath.setAttribute('fill', edgeSettings.color);
      edgePath.setAttribute('opacity', edgeSettings.opacity);
      edgePath.setAttribute('stroke', edgeSettings.color);
      edgePath.setAttribute('stroke-width', edgeSettings.thickness);
      edgePath.setAttribute('stroke-linejoin', 'round');
      
      svg.appendChild(edgePath);
    }
    
    // Create horizontal edge path (top/bottom)
    function createHorizontalEdgePath(variant, x1, y1, x2, y2) {
      const width = Math.abs(x2 - x1);
      const segments = Math.ceil(width / 50); // Divide into segments
      
      if (edgeSettings.style === 'torn' || edgeSettings.style === 'scalloped' || edgeSettings.style === 'wave') {
        // Create repeating pattern for torn/scalloped/wave edges
        let path = `M${x1},${y1}`;
        for (let i = 0; i < segments; i++) {
          const segmentWidth = width / segments;
          const startX = x1 + (i * segmentWidth);
          const endX = x1 + ((i + 1) * segmentWidth);
          
          if (edgeSettings.style === 'torn') {
            const midY = y1 + (Math.random() * 20 - 10);
            path += ` Q${startX + segmentWidth/2},${midY} ${endX},${y1}`;
          } else if (edgeSettings.style === 'scalloped') {
            const midY = y1 + (y1 === 0 ? 15 : -15);
            path += ` Q${startX + segmentWidth/2},${midY} ${endX},${y1}`;
          } else if (edgeSettings.style === 'wave') {
            const midY = y1 + (y1 === 0 ? 10 : -10);
            path += ` Q${startX + segmentWidth/3},${midY} ${startX + segmentWidth*2/3},${y1}`;
            path += ` Q${startX + segmentWidth*2/3},${midY} ${endX},${y1}`;
          }
        }
        return path;
      } else if (edgeSettings.style === 'zigzag' || edgeSettings.style === 'spikes') {
        // Create zigzag/spikes pattern
        let path = `M${x1},${y1}`;
        for (let i = 0; i < segments; i++) {
          const segmentWidth = width / segments;
          const startX = x1 + (i * segmentWidth);
          const endX = x1 + ((i + 1) * segmentWidth);
          
          if (edgeSettings.style === 'zigzag') {
            const midY = y1 + (y1 === 0 ? 15 : -15);
            path += ` L${startX + segmentWidth/2},${midY} L${endX},${y1}`;
          } else if (edgeSettings.style === 'spikes') {
            const midY = y1 + (y1 === 0 ? 20 : -20);
            path += ` L${startX + segmentWidth/2},${midY} L${endX},${y1}`;
          }
        }
        return path;
      } else {
        // Straight edge
        return `M${x1},${y1} L${x2},${y2}`;
      }
    }
    
    // Create vertical edge path (left/right)
    function createVerticalEdgePath(variant, x1, y1, x2, y2) {
      const height = Math.abs(y2 - y1);
      const segments = Math.ceil(height / 50); // Divide into segments
      
      if (edgeSettings.style === 'torn' || edgeSettings.style === 'scalloped' || edgeSettings.style === 'wave') {
        // Create repeating pattern for torn/scalloped/wave edges
        let path = `M${x1},${y1}`;
        for (let i = 0; i < segments; i++) {
          const segmentHeight = height / segments;
          const startY = y1 + (i * segmentHeight);
          const endY = y1 + ((i + 1) * segmentHeight);
          
          if (edgeSettings.style === 'torn') {
            const midX = x1 + (Math.random() * 20 - 10);
            path += ` Q${midX},${startY + segmentHeight/2} ${x1},${endY}`;
          } else if (edgeSettings.style === 'scalloped') {
            const midX = x1 + (x1 === 0 ? 15 : -15);
            path += ` Q${midX},${startY + segmentHeight/2} ${x1},${endY}`;
          } else if (edgeSettings.style === 'wave') {
            const midX = x1 + (x1 === 0 ? 10 : -10);
            path += ` Q${midX},${startY + segmentHeight/3} ${midX},${startY + segmentHeight*2/3}`;
            path += ` Q${midX},${startY + segmentHeight*2/3} ${x1},${endY}`;
          }
        }
        return path;
      } else if (edgeSettings.style === 'zigzag' || edgeSettings.style === 'spikes') {
        // Create zigzag/spikes pattern
        let path = `M${x1},${y1}`;
        for (let i = 0; i < segments; i++) {
          const segmentHeight = height / segments;
          const startY = y1 + (i * segmentHeight);
          const endY = y1 + ((i + 1) * segmentHeight);
          
          if (edgeSettings.style === 'zigzag') {
            const midX = x1 + (x1 === 0 ? 15 : -15);
            path += ` L${midX},${startY + segmentHeight/2} L${x1},${endY}`;
          } else if (edgeSettings.style === 'spikes') {
            const midX = x1 + (x1 === 0 ? 20 : -20);
            path += ` L${midX},${startY + segmentHeight/2} L${x1},${endY}`;
          }
        }
        return path;
      } else {
        // Straight edge
        return `M${x1},${y1} L${x2},${y2}`;
      }
    }
    
    // Initialize edge controls with live updates (no apply button needed)
    function initializeEdgeControls() {
      // Edge style change
      const edgeStyleSelect = document.getElementById('edge-style');
      edgeStyleSelect.addEventListener('change', (e) => {
        edgeSettings.style = e.target.value;
        applyEdgeEffect();
      });
      
      // Edge variant change
      const edgeVariantSelect = document.getElementById('edge-variant');
      edgeVariantSelect.addEventListener('change', (e) => {
        edgeSettings.variant = e.target.value;
        applyEdgeEffect();
      });
      
      // Edge thickness
      const edgeThicknessInput = document.getElementById('edge-thickness');
      edgeThicknessInput.addEventListener('input', (e) => {
        edgeSettings.thickness = parseInt(e.target.value);
        document.getElementById('edge-thickness-value').textContent = edgeSettings.thickness;
        applyEdgeEffect();
      });
      
      // Edge opacity
      const edgeOpacityInput = document.getElementById('edge-opacity');
      edgeOpacityInput.addEventListener('input', (e) => {
        edgeSettings.opacity = parseFloat(e.target.value);
        document.getElementById('edge-opacity-value').textContent = edgeSettings.opacity;
        applyEdgeEffect();
      });
      
      // Edge color
      const edgeColorInput = document.getElementById('edge-color');
      edgeColorInput.addEventListener('change', (e) => {
        edgeSettings.color = e.target.value;
        applyEdgeEffect();
      });
      
      console.log('‚úÖ Edge controls initialized with live updates');
    }
    
    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
      initializeEdgeControls();
      console.log('üéØ Edge system test ready - all changes should be live!');
    });
  </script>
</body>
</html>
